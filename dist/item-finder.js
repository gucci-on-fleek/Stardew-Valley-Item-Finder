let n,t,o;function e(){const o={item_table:document.getElementById("item_table")};t=new Proxy(o,{get:(n,t)=>(void 0!==n[t]&&null!==n[t]||(n[t]=document.getElementById(t)),n[t]),deleteProperty:(n,t)=>(n[t].remove(),delete n[t],!0)});n=new Proxy({_header_cell(n){const o=f(t.header_cell_base).firstElementChild;return o.insertAdjacentHTML("beforeend",n),o},column_header_cell(n){const t=this._header_cell(n);return t.setAttribute("scope","col"),t},row_header_cell(n){const t=this._header_cell(n);return t.setAttribute("scope","row"),t},header(n){const o=f(t.header_base).firstElementChild;return o.appendChild(n),o},wiki_link(n){const o=f(t.wiki_link_base).firstElementChild;return o.href+=encodeURIComponent(n),o},wiki_search(n){const o=f(t.wiki_search_base).firstElementChild;return o.href+=encodeURIComponent(n),o}},{get:(n,o)=>(void 0===n[o]&&(n[o]=()=>f(t[o+"_base"]).firstElementChild),n[o])})}function c(){e();const n=[[t.save_file_input,"change",n=>r(n)],[t.filter,"keyup",()=>U()],[t.down_button,"click",()=>G(o)],[document.body,"dragover",n=>n.preventDefault()],[document.body,"drop",n=>r(n)],...[...u("summary")].map((n=>[n,"mousedown",n=>{n.preventDefault(),n.target.click()}]))];for(const[t,o,e]of n)t.addEventListener(o,e)}function r(n){let o;if(n.preventDefault(),m({show_loading:!0,show_input:!1}),n instanceof window.DragEvent)n.dataTransfer.dropEffect="copy",o=n.dataTransfer.files[0];else{if(!(n.target instanceof window.HTMLInputElement))return void l(t.error);o=n.target.files[0]}const e=new FileReader;e.onload=function(){const n=w(e.result);p(["./dist/items.xslt","./dist/items-to-csv.xslt"]).then((function(t){const o=h(w(t[0]),n);a(g(_(h(w(t[1]),o)))),D()})).finally((()=>m({show_loading:!1,show_input:!0}))).catch((()=>l(t.error)))},e.readAsText(o)}function i(){const n=localStorage.getItem("csv");n&&(m({show_loading:!0,show_input:!0}),o=n,a(g(n)),D(),m({show_loading:!1,show_input:!0}))}function s(n){return document.querySelector(n)}function u(n){return document.querySelectorAll(n)}function f(n){return n.content.cloneNode(!0)}function a(t){let o=n.table();o=v(t,o),o=y(t,o),P(o),L(),E()}function d(n){n.hidden=!0}function l(n){n.hidden=!1}function m({show_loading:n=!0,show_input:o=!0}={}){const e=t.loading,c=s("label[for=save_file_input]");n?(l(e),o||d(c)):(l(c),d(e))}function w(n){return(new DOMParser).parseFromString(n,"text/xml")}function p(n){const t=[];for(const o of n)t.push(fetch(o).then((n=>n.text())));return Promise.all(t)}function h(n,t){const o=new XSLTProcessor;o.importStylesheet(n);return o.transformToFragment(t,new Document)}function _(n){const t=n.firstChild;return o=t.wholeText,localStorage.setItem("csv",o),o}function g(n){return n.split("\n").map((n=>n.split(","))).slice(0,-1)}function k(n,t){n.appendChild(document.createTextNode(t))}function v(t,o){for(const e of t.slice(1)){const t=o.insertRow();for(const[o,c]of e.entries())switch(o){case 0:t.appendChild(n.row_header_cell(c));break;case 1:{const n=t.insertCell(),o=b(c);n.appendChild(o);break}default:k(t.insertCell(),x(c))}}return o}function y(t,o){const e=new DocumentFragment,c=t[0];for(const t of c)e.append(n.column_header_cell(t));return o.tHead.appendChild(n.header(e)),o}function b(t){switch(t){case"Silver":return n.silver();case"Gold":return n.gold();case"Iridium":return n.iridium();default:return document.createTextNode("")}}function x(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"â€¯")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),window.addEventListener("load",(function(){i(),window.location.origin.includes("127.0.0.1")||navigator.serviceWorker.register("service-worker.js")}));const P=function(){let n=!1;return function(o){d(s("article")),n&&delete t.item_table,o=I(o);t.table_container.appendChild(o),l(s("article")),n=!0}}();function R(n){const t=n.match(/\d/g);return t?Number(t.join("")):0}function I(n){const t=n.tFoot;let o=0,e=0;const c="filter_"+M;for(;t.rows[0];)t.rows[0].remove();for(const t of n.tBodies[0].rows)t.classList.contains(c)||(e+=R(t.cells[3].textContent),o+=R(t.cells[5].textContent));const r=t.insertRow(),i=()=>k(r.insertCell(),"");return k(r.insertCell(),"Total"),i(),i(),k(r.insertCell(),x(e)),i(),k(r.insertCell(),x(o)),n}function S(n,t){n.addEventListener("click",t),n.setAttribute("tabindex","0"),n.addEventListener("keydown",(function(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),t(n))}))}function L(){const n=()=>t.item_table.tHead.rows[0].cells;for(const t of n())S(t,(function({target:t}){const o=t.cellIndex,e="ascending"!==t.getAttribute("aria-sort");C(o,e),n()[o].focus(),n()[o].setAttribute("aria-sort",e?"ascending":"descending"),U()}))}const C=function(){const n=["Iridium","Gold","Silver",""],t=[{test:n=>/\d/.test(n),compare:(n,t)=>R(n)-R(t)},{test:t=>-1!==n.indexOf(t),compare:(t,o)=>n.indexOf(o)-n.indexOf(t)},{test:()=>!0,compare:(n,t)=>n.localeCompare(t)}];return function(n,e=!0){const c=g(o),r=c.slice(1);let i;for(const o of t)if(o.test(r[0][n])){i=e?(t,e)=>o.compare(t[n],e[n]):(t,e)=>o.compare(e[n],t[n]);break}r.sort(i),r.splice(0,0,c[0]),a(r)}}();function D(){const n=t.item_table.tHead.rows[0].cells;n[n.length-1].setAttribute("aria-sort","descending")}function G(n){const t=document.createElement("a");t.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(n)),t.setAttribute("download","Stardew Valley Items.csv"),d(t),document.body.appendChild(t),t.click(),document.body.removeChild(t)}let M=1;function U(){const n=t.filter.value,o=t.item_table,e=o.tBodies[0].rows,c=RegExp(n,"i"),r=M-1-1,i="filter_"+M,s="filter_"+r;F();for(const n of e)n.textContent.match(c)||n.classList.add(i),n.classList.remove(s);const u=document.styleSheets[0];u.insertRule(`.${i} {visibility: collapse}`),r>=0&&u.deleteRule(1),I(o),M++}function E(){const o=t.item_table.tBodies[0];S(o,(function(t){const e=t.target;if(0!==e.cellIndex)return;const c=O(e.textContent);let r;j(c).finally((function(){F();const n=o.insertRow(e.parentElement.rowIndex);n.className="item_description",r=n.insertCell(),r.colSpan=6})).then((function(t){r.innerHTML=t,k(r," "),r.appendChild(n.wiki_link(c))})).catch((function(t){r.innerHTML=t.message,k(r," "),r.appendChild(n.wiki_search(c))}))}))}async function j(n){const t="https://stardewvalleywiki.com/mediawiki/api.php?"+new URLSearchParams({action:"query",format:"json",formatversion:"2",redirects:"",origin:"*",prop:"pageprops",titles:n}).toString(),o=await fetch(t),e=await o.json();try{return e.query.pages[0].pageprops.description}catch{throw Error("Item not found.")}}function F(){const n=u(".item_description");for(const t of n)t.remove()}const J=["Honey","Juice","Wine","Jelly","Aged Roe","Roe"];function O(n){if(n.includes("L. Goat Milk"))return"Large Goat Milk";if(n.includes("Pickled"))return"Pickles";for(const t of J)if(n.includes(t))return t;return n}
//# sourceMappingURL=item-finder.js.map