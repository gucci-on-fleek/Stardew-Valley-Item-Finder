const t=[];function n(t){let n;return window.CustomEvent&&"function"==typeof window.CustomEvent?n=new CustomEvent(t):(n=document.createEvent("CustomEvent"),n.initCustomEvent(t,!1,!1,void 0)),n}function o(t){return t.getAttribute("data-sort")||t.textContent||t.innerText||""}function e(t,n){return(t=t.trim().toLowerCase())===(n=n.trim().toLowerCase())?0:t<n?1:-1}function r(t,n){return[].slice.call(t).find((function(t){return t.getAttribute("data-sort-column-key")===n}))}function i(t,n){return function(o,e){const r=t(o.td,e.td);return 0===r?n?e.index-o.index:o.index-e.index:r}}class s{constructor(t,n){if(!(this instanceof s))return new s(t,n);if(!t||"TABLE"!==t.tagName)throw Error("Element must be a table");this.init(t,n||{})}init(t,n){const o=this;let e,r;if(o.table=t,o.thead=!1,o.options=n,t.rows&&t.rows.length>0)if(t.tHead&&t.tHead.rows.length>0){for(const n of t.tHead.rows)if("thead"===n.getAttribute("data-sort-method")){e=n;break}e||(e=t.tHead.rows[t.tHead.rows.length-1]),o.thead=!0}else e=t.rows[0];if(e){for(const t of e.cells)t.setAttribute("role","columnheader"),"none"!==t.getAttribute("data-sort-method")&&(t.tabindex=0,t.addEventListener("click",i,!1),null!==t.getAttribute("data-sort-default")&&(r=t));r&&(o.current=r,o.sort_table(r))}function i(){o.current!==this&&t.querySelectorAll("[aria-sort]").forEach((t=>t.removeAttribute("aria-sort"))),o.current=this,o.sort_table(this)}}static extend(n,o,e){if("function"!=typeof o||"function"!=typeof e)throw Error("Pattern and sort must be a function");t.push({name:n,pattern:o,sort:e})}sort_table(s,f){const a=this,c=s.getAttribute("data-sort-column-key"),d=s.cellIndex;let u=e;const l=[];let h=a.thead?0:1;const m=s.getAttribute("data-sort-method");let b=s.getAttribute("aria-sort");if(a.table.dispatchEvent(n("beforeSort")),f||(b="ascending"===b?"descending":"descending"===b?"ascending":a.options.descending?"descending":"ascending",s.setAttribute("aria-sort",b)),!(a.table.rows.length<2)){if(!m){let t;for(;l.length<3&&h<a.table.tBodies[0].rows.length;){t=c?r(a.table.tBodies[0].rows[h].cells,c):a.table.tBodies[0].rows[h].cells[d];let n=t?o(t):"";n=n.trim(),n.length>0&&l.push(n),h++}if(!l)return}for(const n of t)if(m){if(n.name===m){u=n.sort;break}}else if(l.every(n.pattern)){u=n.sort;break}a.col=d;for(const t of a.table.tBodies){const n=[],e={};let s,f=0,d=0;if(!(t.rows.length<2)){for(const i of t.rows){let t;"none"===i.getAttribute("data-sort-method")?e[f]=i:(t=c?r(i.cells,c):i.cells[a.col],n.push({tr:i,td:t?o(t):"",index:f})),f++}for("descending"===b?n.sort(i(u,!0)):(n.sort(i(u,!1)),n.reverse()),s=0;s<f;s++){let o;e[s]?(o=e[s],d++):o=n[s-d].tr,t.appendChild(o)}}}a.table.dispatchEvent(n("afterSort"))}}refresh(){const t=this;void 0!==t.current&&t.sort_table(t.current,!0)}}export{s as Tablesort};
//# sourceMappingURL=tablesort.js.map