"use strict";const t={heading:'<article><h2>Items<input type="text" id="filter" class="input" onkeyup="filter_table()" placeholder="Filter" title="Filter" aria-label="Filter Table" ></input></h2>',download:t=>`<input type="button" id="down-button" class="input" value="Download as CSV" onclick="download_as_csv(${t})" />`,table:{t:'<table id="item_table">',end:"</table></article>",o:t=>`<td>${t}</td>`,i:t=>`<th tabindex="0">${t}</th>`},l:{t:'<thead><tr class="header">',end:"</tr></thead>"},body:{t:"<tbody>",end:"</tbody>"},s:{t:"<tr>",end:"</tr>"},u:{t:"<tfoot>",end:"</tfoot>"},m:{g:'<img src="assets/silver_star.png" class="icon" alt="Silver" title="Silver" /><div class="sort-id">1 Silver</div>',v:'<img src="assets/gold_star.png" class="icon" alt="Gold" alt="Gold" title="Gold" /><div class="sort-id">2 Gold</div>',p:'<img src="assets/iridium_star.png" class="icon" alt="Iridium" title="Iridium" /><div class="sort-id">3 Iridium</div>'}};function file_opened(t){const c=t.target,s=new FileReader;s.onload=function(){const t=e(s.result);n(["items.xslt","items-to-csv.xslt"]).then((function(n){const c=o(e(n[0]),t);d(r(l(i(o(e(n[1]),c))))),f()}))},s.readAsText(c.files[0])}function e(t){return(new DOMParser).parseFromString(t,"text/xml")}function n(t){let e=[];for(let n=0;n<t.length;n++)e.push(fetch(t[n]).then(t=>t.text()));return Promise.all(e)}function o(t,e){const n=new XSLTProcessor;return n.importStylesheet(t),n.transformToFragment(e,new Document)}let csv_string;function i(t){return csv_string=t.firstChild.wholeText,csv_string}function l(t){return t.split("\n").map(t=>t.split(","))}function r(e){let n=t.table.t;n+=t.l.t;for(let o=0;o<e[0].length;o++)n+=t.table.i(e[0][o]);n+=t.l.end,n+=t.body.t;for(let o=1;o<e.length-1;o++){n+=t.s.t;for(let i=0;i<e[o].length;i++)n+=1!==i?t.table.o(s(e[o][i])):t.table.o(c(e[o][i]));n+=t.s.end}return n+=t.body.end+t.u.t+t.u.end+t.table.end,n}function c(e){return e.replace(/Silver/,t.m.g).replace(/Gold/,t.m.v).replace(/Iridium/,t.m.p)}function s(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"â€¯")}function d(e){let n=t.heading;n+=t.download("csv_string"),n+=e;const o=document.querySelector("article");o&&o.remove(),document.querySelector("output").insertAdjacentHTML("afterbegin",n),u(),document.getElementById("filter").focus()}function a(t){const e=t.match(/\d/g);return e?Number(e.join("")):0}function u(){const e=document.getElementById("item_table").tBodies[0];let n=0,o=0;const i="filter_"+m;for(let t,l=1;t=e.rows[l];l++)t.classList.contains(i)||(o+=a(t.cells[3].textContent),n+=a(t.cells[5].textContent));let l="";l+=t.s.t,l+=t.table.o("Total")+t.table.o("")+t.table.o(""),l+=t.table.o(s(o)),l+=t.table.o(""),l+=t.table.o(s(n))+t.s.end;const r=document.querySelector("tfoot tr");r&&r.remove(),document.querySelector("tfoot").insertAdjacentHTML("afterbegin",l)}function f(){const t=document.getElementById("item_table"),e=new Tablesort(t);Tablesort.extend("number",t=>t.match(/\d/),(t,e)=>a(t)-a(e));const n=t.tHead.rows[0].cells;for(let t=0;t<n.length;t++)n[t].addEventListener("keydown",(function(t){"Enter"===t.key&&e._(t.srcElement)}))}function download_as_csv(t){const e=document.createElement("a");e.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download","Stardew Valley Items.csv"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}let m=1;function filter_table(){const t=document.getElementById("filter").value,e=document.getElementById("item_table").tBodies[0].rows,n=RegExp(t,"i"),o=m-1-1,i="filter_"+m,l="filter_"+o;for(let t=0;t<e.length;t++){let o=e[t];o.textContent.match(n)||o.classList.add(i),o.classList.remove(l)}const r=document.styleSheets[0];r.insertRule(`.${i} {display:none}`),o>=0&&r.deleteRule(1),u(),m++}