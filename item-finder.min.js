"use strict";let csv_string;const t={heading:'<article><h2>Items\n    <input type="text" id="filter" class="input" onkeyup="filter_table()" placeholder="Filter" title="Filter" aria-label="Filter Table" ></input>\n    </h2>',download:t=>`<input type="button" id="down-button" class="input" value="Download as CSV" onclick="download_as_csv(${t})" />`,table:{t:"<table id='item_table'>",end:"</table></article>",o:t=>`<td>${t}</td>`,i:t=>`<th tabindex="0">${t}</th>`},l:{t:"<thead><tr class='header'>",end:"</tr></thead>"},body:{t:"<tbody>",end:"</tbody>"},s:{t:"<tr>",end:"</tr>"},u:{t:"<tfoot>",end:"</tfoot>"},m:{g:'<img src="assets/silver_star.png" class="icon" alt="Silver" title="Silver" /><div class="sort-id">1</div>',v:'<img src="assets/gold_star.png" class="icon" alt="Gold" alt="Gold" /><div class="sort-id">2</div>',h:'<img src="assets/iridium_star.png" class="icon" alt="Iridium" title="Gold" /><div class="sort-id">3</div>'}};function e(t){const e=t.target,d=new FileReader;d.onload=function(){const t=o(d.result);r(["items.xslt","items-to-csv.xslt"]).then((function(e){const r=c(o(e[0]),t);i(s(g(n(c(o(e[1]),r))))),l()}))},d.readAsText(e.files[0])}function n(t){return csv_string=t.firstChild.wholeText,csv_string}function o(t){return(new DOMParser).parseFromString(t,"text/xml")}function i(e){const n=document.querySelector("output");n.innerHTML="",n.innerHTML+=t.heading,n.innerHTML+=t.download("csv_string"),n.innerHTML+=e,u(),document.querySelector("#filter").focus()}function l(){const t=document.querySelector("#item_table"),e=new Tablesort(t);Tablesort.extend("number",t=>t.match(/\d/),(t,e)=>m(t)-m(e));const n=t.tHead.rows[0].cells;for(let t=0;t<n.length;t++)n[t].addEventListener("keydown",(function(t){"Enter"===t.key&&e.p(t.srcElement)}))}function r(t){let e=[];for(let n=0;n<t.length;n++)e.push(fetch(t[n]).then(t=>t.text()));return Promise.all(e)}function c(t,e){const n=new XSLTProcessor;return n.importStylesheet(t),n.transformToFragment(e,new Document)}function s(e){let n=t.table.t;n+=t.l.t;for(let o=0;o<e[0].length;o++)n+=t.table.i(e[0][o]);n+=t.l.end+t.body.t;for(let o=1;o<e.length-1;o++){n+=t.s.t;for(let i=0;i<e[o].length;i++)n+=1!==i?t.table.o(f(e[o][i])):t.table.o(b(e[o][i]));n+=t.s.end}return n+="</tbody><tfoot></tfoot></table>",t.body.end,t.u.t,t.u.end,t.table.end,n}function d(t){const e=document.createElement("a");e.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download","Stardew Valley Items.csv"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function a(){const t=document.querySelector("#filter").value.toLowerCase();document.querySelectorAll("#item_table tr:not(.header)").forEach(e=>e.style.display=[...e.children].find(e=>e.innerHTML.toLowerCase().match(RegExp(t)))?"":"none"),u()}function u(){document.querySelector("tfoot").innerHTML="";const e=document.querySelector("#item_table");let n=0,o=0;for(let t,i=1;t=e.rows[i];i++)"none"!==t.style.display&&(o+=m(t.cells[3].innerText),n+=m(t.cells[5].innerText));let i="";i+=t.s.t,i+=t.table.o("Total")+t.table.o("")+t.table.o(""),i+=t.table.o(f(o)),i+=t.table.o(""),i+=t.table.o(f(n))+t.s.end,document.querySelector("tfoot").innerHTML=i}function f(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"â€¯")}function m(t){const e=t.match(/\d/g);return e?Number(e.join("")):0}function b(e){return e.replace(/Silver/,t.m.g).replace(/Gold/,t.m.v).replace(/Iridium/,t.m.h)}function g(t){return t.split("\n").map(t=>t.split(","))}