"use strict";let csv_string;const t={heading:'<article><h2>Items\n    <input type="text" id="filter" class="input" onkeyup="filter_table()" placeholder="Filter" title="Filter" aria-label="Filter Table" ></input>\n    </h2>',download:t=>`<input type="button" id="down-button" class="input" value="Download as CSV" onclick="download_as_csv(${t})" />`,table:{t:"<table id='item_table'>",end:"</table></article>",o:t=>`<td>${t}</td>`,i:t=>`<th tabindex="0">${t}</th>`},l:{t:"<thead><tr class='header'>",end:"</tr></thead>"},body:{t:"<tbody>",end:"</tbody>"},s:{t:"<tr>",end:"</tr>"},u:{t:"<tfoot>",end:"</tfoot>"},m:{g:'<img src="assets/silver_star.png" class="icon" alt="Silver" title="Silver" /><div class="sort-id">1 Silver</div>',v:'<img src="assets/gold_star.png" class="icon" alt="Gold" alt="Gold" title="Gold" /><div class="sort-id">2 Gold</div>',p:'<img src="assets/iridium_star.png" class="icon" alt="Iridium" title="Iridium" /><div class="sort-id">3 Iridium</div>'}};function file_opened(t){const d=t.target,s=new FileReader;s.onload=function(){const t=n(s.result);l(["items.xslt","items-to-csv.xslt"]).then((function(l){const d=r(n(l[0]),t);o(c(m(e(r(n(l[1]),d))))),i()}))},s.readAsText(d.files[0])}function e(t){return csv_string=t.firstChild.wholeText,csv_string}function n(t){return(new DOMParser).parseFromString(t,"text/xml")}function o(e){let n="";n+=t.heading,n+=t.download("csv_string"),n+=e,document.querySelector("output").innerHTML=n,s(),document.querySelector("#filter").focus()}function i(){const t=document.querySelector("#item_table"),e=new Tablesort(t);Tablesort.extend("number",t=>t.match(/\d/),(t,e)=>u(t)-u(e));const n=t.tHead.rows[0].cells;for(let t=0;t<n.length;t++)n[t].addEventListener("keydown",(function(t){"Enter"===t.key&&e.h(t.srcElement)}))}function l(t){let e=[];for(let n=0;n<t.length;n++)e.push(fetch(t[n]).then(t=>t.text()));return Promise.all(e)}function r(t,e){const n=new XSLTProcessor;return n.importStylesheet(t),n.transformToFragment(e,new Document)}function c(e){let n=t.table.t;n+=t.l.t;for(let o=0;o<e[0].length;o++)n+=t.table.i(e[0][o]);n+=t.l.end+t.body.t;for(let o=1;o<e.length-1;o++){n+=t.s.t;for(let i=0;i<e[o].length;i++)n+=1!==i?t.table.o(a(e[o][i])):t.table.o(f(e[o][i]));n+=t.s.end}return n+="</tbody><tfoot></tfoot></table>",t.body.end,t.u.t,t.u.end,t.table.end,n}function download_as_csv(t){const e=document.createElement("a").setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(t)).setAttribute("download","Stardew Valley Items.csv").style.display="none";document.body.appendChild(e),e.click(),document.body.removeChild(e)}let d=0;function filter_table(){const t=document.getElementById("filter").value,e=document.querySelectorAll("#item_table tbody tr"),n=t=>"filter_"+t,o=d+1,i=d-1;for(let l=0;l<e.length;l++){let r=e[l];r.textContent.match(RegExp(t,"i"))||r.classList.add(n(o)),r.classList.remove(n(i))}const l=document.styleSheets[0];l.insertRule(`.${n(o)} {display:none}`),i>=0&&l.deleteRule(1),s(),d++}function s(){const e=document.querySelector("#item_table tbody");let n=0,o=0;for(let t,i=1;t=e.rows[i];i++)t.classList.contains("filter_"+(d+1))||(o+=u(t.cells[3].innerText),n+=u(t.cells[5].innerText));let i="";i+=t.s.t,i+=t.table.o("Total")+t.table.o("")+t.table.o(""),i+=t.table.o(a(o)),i+=t.table.o(""),i+=t.table.o(a(n))+t.s.end,document.querySelector("tfoot").innerHTML=i}function a(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"â€¯")}function u(t){const e=t.match(/\d/g);return e?Number(e.join("")):0}function f(e){return e.replace(/Silver/,t.m.g).replace(/Gold/,t.m.v).replace(/Iridium/,t.m.p)}function m(t){return t.split("\n").map(t=>t.split(","))}